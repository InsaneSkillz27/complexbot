"use strict";

var bower = require('bower');     //bower组件安装
var defaultConfig = require('../config');
var mout = require('mout');
var cli = require('../util/cli');  //命令行
var file = require('file-utils');
var path = require('path');
/**
 * 注册组件,如果没有指定name和url
 * iffront register [name url]
 * @name 组件名称
 * @url  组件的git路径
 */
function register(name, url) {
    
    
    if(typeof name == 'undefined' || typeof url == 'undefined'){
        //读取当前目录下的package文件
        var pkg = file.readJSON('package.json');
        name = pkg.name;   //组件名称
        url = pkg.repository.url; //组件的git地址
    }
    bower.commands.register(name , url , {'registry': defaultConfig.registry , "strictSsl":false}).on("end" , function(result){
        console.log(result); //注册成功    
    }).on('error' , function(error){
        console.log(error);  //注册失败
    });
}

// -------------------

register.line = function (argv) {
    var options = register.options(argv);
    var name = options.argv.remain[1];
    var url = options.argv.remain[2];
    /*
    if (!name || !url) {
        console.log('please set module and git url');
        return;
    }
    */
    return register(name, url);
};

register.options = function (argv) {
    return cli.readOptions(argv);
};

register.completion = function () {
    // TODO:
};

module.exports = register;